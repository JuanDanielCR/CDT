package mx.edu.eld.convocatoria.action;

import org.apache.struts2.convention.annotation.Namespace;
import org.apache.struts2.convention.annotation.Result;
import org.apache.struts2.convention.annotation.Results;
import org.springframework.beans.factory.annotation.Autowired;

import com.opensymphony.xwork2.ModelDriven;
import com.opensymphony.xwork2.validator.annotations.VisitorFieldValidator;

import mx.edu.eld.calendario.mapeo.Convocatoria;
import mx.edu.eld.convocatoria.bs.ConvocatoriaBs;
import mx.ipn.escom.cdt.util.action.ActionSupportCDT;
import mx.ipn.escom.cdt.util.bs.GenericSearchBs;

@Namespace("/convocatoria")
@Results({ @Result(name = ActionSupportCDT.SUCCESS, type = "redirectAction", params = { "actionName",
"gestionar-convocatoria" }) })
public class ConfigurarConvocatoriaAct extends ActionSupportCDT implements ModelDriven<Convocatoria>{

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	
	private Convocatoria model;
	
	private Integer idSel;
	
	@Autowired
	private GenericSearchBs genericSearchBs;
	
	@Autowired
	private ConvocatoriaBs convocatoriaBs;
	
	
	public String edit(){
		getModel();
		return EDIT;
	}
	
	public void validateUpdate() throws Exception{
		try{
			convocatoriaBs.validarConfiguracion(model);
		} catch (Exception e){
			addActionError("El número de aceptados no puede ser mayor al número de entrevistados.");
		}
	}
	
	public String update(){
		convocatoriaBs.update(model);
		return SUCCESS;
	}

	@VisitorFieldValidator
	public Convocatoria getModel() {
		if (model == null){
			model = new Convocatoria();
		}
		return model;
	}

	public void setModel(Convocatoria model) {
		this.model = model;
	}

	public Integer getIdSel() {
		return idSel;
	}

	public void setIdSel(Integer idSel) {
		if (idSel != null) {
			model = genericSearchBs.findById(Convocatoria.class, idSel);
		}
		this.idSel = idSel;
		
	}

	public GenericSearchBs getGenericSearchBs() {
		return genericSearchBs;
	}

	public void setGenericSearchBs(GenericSearchBs genericSearchBs) {
		this.genericSearchBs = genericSearchBs;
	}

	public ConvocatoriaBs getConvocatoriaBs() {
		return convocatoriaBs;
	}

	public void setConvocatoriaBs(ConvocatoriaBs convocatoriaBs) {
		this.convocatoriaBs = convocatoriaBs;
	}

}
